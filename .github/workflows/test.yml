name: Test Monitor and Unicorn Server

on:
  workflow_call:
    secrets:
      API_TOKEN:
        required: true
    inputs:
      APPS:
        required: true
        type: string
      API_URL:
        required: true
        type: string

jobs:
  run-containers:
    runs-on: ubuntu-latest
    steps:
      - name: Pull Unicorn Server image
        run: docker pull ghcr.io/${{ github.repository_owner }}/python:latest

      - name: Create Docker network
        run: docker network create my-network || true

      - name: Run Unicorn Server container
        run: docker run -d --name unicorn-server --network my-network -p 8000:8000 ghcr.io/${{ github.repository_owner }}/python:latest

      - name: Run Monitor container
        run: docker run --name monitor-container --network my-network -e API_URL=${{ vars.API_URL }} -e APPS=${{ vars.APPS }} -e API_TOKEN=${{ secrets.API_TOKEN }} ghcr.io/${{ github.repository_owner }}/python:latest python monitor.py